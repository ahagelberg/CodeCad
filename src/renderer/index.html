<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code CAD</title>
    <script>
        // Suppress all errors before the app loads
        window.addEventListener('error', function(e) {
            console.log('Pre-app error suppressed:', e.error);
            e.preventDefault();
            e.stopPropagation();
            return false;
        });
        
        window.addEventListener('unhandledrejection', function(e) {
            console.log('Pre-app unhandled rejection suppressed:', e.reason);
            e.preventDefault();
            e.stopPropagation();
            return false;
        });
        
        window.onerror = function(message, source, lineno, colno, error) {
            console.log('Pre-app window.onerror suppressed:', message);
            return true;
        };
        
        window.onunhandledrejection = function(e) {
            console.log('Pre-app window.onunhandledrejection suppressed:', e.reason);
            e.preventDefault();
            return true;
        };
    </script>
</head>
<body>
    <div id="app">
        <!-- Top toolbar -->
        <div id="toolbar">
            <div class="toolbar-section">
                <button id="new-file" class="toolbar-btn" title="New File (Ctrl+N)">
                    <span class="icon">üìÑ</span>
                </button>
                <button id="open-file" class="toolbar-btn" title="Open File (Ctrl+O)">
                    <span class="icon">üìÇ</span>
                </button>
                <button id="save-file" class="toolbar-btn" title="Save File (Ctrl+S)">
                    <span class="icon">üíæ</span>
                </button>
            </div>
            
            <div class="toolbar-section">
                <select id="language-selector" class="language-selector">
                    <option value="javascript">JavaScript</option>
                    <option value="openscad">OpenSCAD</option>
                </select>
            </div>
            
            <div class="toolbar-section">
                <button id="export-stl" class="toolbar-btn" title="Export STL">
                    <span class="icon">üì¶</span>
                </button>
                <button id="export-step" class="toolbar-btn" title="Export STEP">
                    <span class="icon">üìã</span>
                </button>
                <button id="settings" class="toolbar-btn" title="Settings">
                    <span class="icon">‚öôÔ∏è</span>
                </button>
            </div>
            
            <div class="toolbar-section">
                <div id="status-bar">
                    <span id="language-indicator">JavaScript</span>
                </div>
            </div>
        </div>

        <!-- Main content area -->
        <div id="main-content">
            <!-- Left pane - Code Editor -->
            <div id="editor-pane">
                <div class="pane-header">
                    <h3>Script Editor</h3>
                    <div class="pane-controls">
                        <button id="toggle-editor" class="pane-toggle" title="Toggle Editor">‚àí</button>
                    </div>
                </div>
                <div id="editor-container">
                    <div id="monaco-editor"></div>
                </div>
            </div>

            <!-- Resizer -->
            <div id="resizer"></div>

            <!-- Right pane - 3D Viewer -->
            <div id="viewer-pane">
                <div class="pane-header">
                    <h3>3D Viewer</h3>
                    <div class="pane-controls">
                        <button id="reset-camera" class="viewer-btn" title="Reset Camera">üéØ</button>
                        <button id="toggle-viewer" class="pane-toggle" title="Toggle Viewer">‚àí</button>
                    </div>
                </div>
                <div id="viewer-container">
                    <canvas id="three-canvas"></canvas>
                    <div id="viewer-overlay">
                        <div id="viewer-info">
                            <div id="camera-info">
                                <span>Camera: X: 0, Y: 0, Z: 10</span>
                            </div>
                            <div id="object-info">
                                <span>Objects: 0</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Debug Panel - Full width below viewer -->
                <div id="debug-panel" class="debug-panel">
                    <div class="debug-header">
                        <span>Debug Console</span>
                        <div class="debug-controls">
                            <button id="toggle-debug" class="debug-toggle-btn" title="Toggle Debug Panel">‚ñ≤</button>
                            <button id="clear-debug" class="debug-clear-btn">Clear</button>
                        </div>
                    </div>
                    <div id="debug-messages" class="debug-messages"></div>
                </div>
            </div>
        </div>

        <!-- Bottom status bar -->
        <div id="bottom-status">
            <div class="status-section">
                <span id="cursor-position">Line 1, Column 1</span>
            </div>
            <div class="status-section">
                <span id="status-message">Ready</span>
            </div>
            <div class="status-section">
                <span id="file-info">Untitled</span>
            </div>
            <div class="status-section">
                <span id="render-time">Render: 0ms</span>
            </div>
        </div>
    </div>

    <!-- Loading overlay -->
    <div id="loading-overlay" class="hidden">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>Processing script...</p>
        </div>
    </div>

    <!-- Error dialog -->
    <div id="error-dialog" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Error</h3>
                <button id="close-error" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <pre id="error-message"></pre>
            </div>
            <div class="modal-footer">
                <button id="error-ok" class="btn btn-primary">OK</button>
            </div>
        </div>
    </div>

    <!-- Script templates -->
    <script type="text/template" id="template-javascript">
// JavaScript CAD Script
// 3D Primitives
const myCube = cube([10, 10, 10]);
const myBox = box([8, 8, 8]);  // box is an alias for cube
const mySphere = sphere(5);
const myCylinder = cylinder(3, 8);

// 2D Shapes
const myRectangle = rectangle(8, 6);
const myCircle = circle(4);
const myPolygon = polygon([[0, 0], [4, 0], [2, 4]]);

// Extrusion
const extrudedRect = linear_extrude(myRectangle, 5);
const rotatedShape = rotate_extrude(myCircle, 2 * Math.PI);

// Transformations
translate(mySphere, [15, 0, 0]);
move(myCube, [0, 10, 0]);  // move is an alias for translate
rotate(myCylinder, [0, 0, Math.PI/4]);
scale(mySphere, [2, 1, 1]);
    </script>

    <script type="text/template" id="template-openscad">
// OpenSCAD Script
// 3D Primitives
cube([10, 10, 10]);
sphere(r=5);
cylinder(r=3, h=8);

// 2D Shapes
square([8, 6]);
circle(r=4);
polygon(points=[[0, 0], [4, 0], [2, 4]]);

// Extrusion
linear_extrude(height=5) square([8, 6]);
rotate_extrude() circle(r=4);

        // Combine objects
        union() {
            cube([10, 10, 10]);
            translate(sphere(r=5), [15, 0, 0]);
            move(cube([5, 5, 5]), [0, 10, 0]);  // move is an alias for translate
            rotate(cube([3, 3, 3]), [0, 0, 45]);
        }
    </script>
</body>
</html>
